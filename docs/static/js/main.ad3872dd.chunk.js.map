{"version":3,"sources":["component/loadMaterial.ts","component/materialClick.ts","component/ZoomSlider.tsx","lib/undoRedo.ts","component/FunctionBar.tsx","component/ButtonGroup.tsx","component/TabButton.tsx","component/Menu.tsx","App.tsx","serviceWorker.ts","lib/ImageTileManager.ts","lib/MapPoint.ts","lib/TileSprite.ts","lib/ShortcutManager.ts","lib/EditableMap.ts","lib/DraggingCheck.ts","lib/key.ts","index.tsx","lib/DeepFreeze.ts","assets/tileset_0.png","assets/tileset_1.png","assets/tileset_2.png","assets/tileset_3.png","assets/tileset_4.png","assets/tileset_5.png","assets/tileset_6.png","assets/tileset_7.png","assets/tileset_8.png","assets/tileset_9.png"],"names":["loadMaterial","data","containerImage","containerPosition","a","Promise","resolve","sprite","alias","resourceList","push","PIXI","from","materialToUrl","spritePosition","container","i","length","height","width","h","w","imgIdx","imgTop","imgLeft","previousWhich","materialClick","which","document","getElementById","style","boxShadow","ValueLabelComponent","props","children","open","value","Tooltip","enterTouchDelay","placement","title","ZoomSlider","context","zoom","event","setState","scale","Math","max","min","mapViewer","stage","set","state","className","paddingLeft","paddingRight","onClick","color","Slider","defaultValue","this","aria-valuetext","aria-labelledby","valueLabelDisplay","marks","track","step","onChange","marginLeft","marginRight","React","Component","undoRecord","redoRecord","FunctionBar","undo","record","pop","param","forceUpdate","redo","updateButtonState","updatePhysicsSate","checked","physicsLayer","emitter","on","IconButton","size","window","disabled","Switch","e","emit","target","off","ButtonGroup","lastAlias","choose","id","map","child","key","selectedStyle","updateSelected","bind","TabButton","Menu","materialImage","materialPosition","settingPanel","loaded","manager","then","background","last","console","log","idx","deleteTWTile","removeAt","split","alt","src","toString","draggable","marginTop","margin","CircularProgress","theme","createMuiTheme","App","ThemeProvider","isLocalhost","Boolean","location","hostname","match","register","config","navigator","URL","process","href","origin","addEventListener","swUrl","fetch","headers","response","contentType","get","status","indexOf","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","error","PointSystem","ImageTileManager","images","collections","r","forEach","mapTexture","collection","y","x","texture","baseTexture","destroy","physicsVisualization","TileSprite","layer","phyTile","PhysicsTile","interactive","position","highest","_layer","clear","ceil","floor","lineStyle","beginFill","drawRect","endFill","updateColor","KeyAction","MapPoint","sys","MAP","sqrt","pow","point","Click","shortcutManager","_registeredEvent","_triggerHistory","_keyCollection","_keyActionHistory","keyCode","preventDefault","outter","code","keyid","action","PRESS","callback","DOWN","DraggingChecker","draggableObject","_startChecking","draggingPoint","dragging","getLocalPosition","c","abs","Key","EditableMap","imageSet","mapWidth","mapHeight","groundTile","_tile","_showPhysics","_editableTile","Map","_editablePhysics","_hoverGraphics","_lastCursorPos","_startDrag","_draggingChecker","_draggingArea","onDrag","cursor","addChild","_updateCursor","fromPoint","toMapSys","_updateSelectedArea","addXY","originalEvent","RIGHT","removeChild","LEFT","result","tileData","tileSaver","undefined","loc","pos","parseInt","ri","layerLevel","tile","_createImageTile","toPhysicsTile","_shortcutConfig","_shiftMap","_switchPhysicsLayer","showPhysicsLayer","offset","pivot","_correctPoint","tem","image","x1","y1","x2","y2","obj","index","spriteList","topTile","list","rows","cols","objects","tileW","tileH","json","tileset_0","tileset_1","tileset_2","tileset_3","tileset_4","tileset_5","tileset_6","tileset_7","tileset_8","tileset_9","download","fileAlias","type","file","Blob","createElement","url","createObjectURL","body","appendChild","click","revokeObjectURL","EventEmitter","loader","shared","innerWidth","innerHeight","view","overflow","zIndex","renderer","autoDensity","oncontextmenu","onresize","resize","add","selected","load","resources","loadTexture","myMap","fromJSON","jsonData","showHoverEffect","hotkeys","MapObjects","combination","stack","deepFreeze","names","Object","getOwnPropertyNames","prop","freeze","delete","ReactDOM","render","module","exports"],"mappings":"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","file":"static/js/main.ad3872dd.chunk.js","sourcesContent":["import { ImageTileManager } from \"../lib/ImageTileManager\";\r\nimport * as PIXI from 'pixi.js';\r\nimport { resourceList } from '../index';\r\n/**\r\n * @param {ImageTileManager} data  image data\r\n * @param {Array<String>} containerImage  save imageurl here\r\n * @param {Array<String>} containerPosition  save imagePosition here \r\n */\r\n\r\nexport const loadMaterial = async (data: ImageTileManager, containerImage: Array<String>, containerPosition: Array<Object>): Promise<void> => {\r\n\treturn new Promise<void>(resolve => {\r\n\t\tlet sprite: Array<PIXI.Sprite> = [];\r\n\t\tfor (let alias in resourceList) {\r\n\t\t\tif (alias != \"tileset_4\")\r\n\t\t\t\tsprite.push(PIXI.Sprite.from(resourceList[alias]));\r\n\t\t}\r\n\r\n\t\tmaterialToUrl(containerImage);\r\n\t\tspritePosition(sprite, containerPosition);\r\n\r\n\t\tresolve();\r\n\t});\r\n}\r\n\r\nconst materialToUrl = async (container: Array<String>): Promise<void> => {\r\n\treturn new Promise<void>(resolve => {\r\n\t\tfor (let alias in resourceList) {\r\n\t\t\tif (alias != \"tileset_4\")\r\n\t\t\t\tcontainer.push(resourceList[alias]);\r\n\t\t}\r\n\r\n\t\tresolve();\r\n\t});\r\n}\r\n\r\nconst spritePosition = async (sprite: Array<PIXI.Sprite>, container: Array<Object>): Promise<void> => {\r\n\treturn new Promise<void>(resolve => {\r\n\t\tfor (let i = 0; i < sprite.length; ++i) {\r\n\t\t\tconst height: number = sprite[i].height / 32;\r\n\t\t\tconst width: number = sprite[i].width / 32;\r\n\t\t\tfor (let h = 0; h < height; h++) {\r\n\t\t\t\tfor (let w = 0; w < width; w++) {\r\n\r\n\t\t\t\t\tlet data: object = {\r\n\t\t\t\t\t\timgIdx: i,\r\n\t\t\t\t\t\timgTop: -32 * h,\r\n\t\t\t\t\t\timgLeft: -32 * w,\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcontainer.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tresolve();\r\n\t});\r\n}","let previousWhich = null;\r\n\r\n/**\r\n * @param {string} which  button ID\r\n */\r\nexport const materialClick = (which: string): void => {\r\n\tif (previousWhich != null)\r\n\t\tdocument.getElementById(previousWhich).style.boxShadow = '';\r\n\r\n\tdocument.getElementById(which).style.boxShadow = '0px 0px 5px 2.5px #ffffff';\r\n\tpreviousWhich = which;\r\n}\r\n","import React from 'react';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport IconButton from '@material-ui/core/Tooltip';\r\nimport { Slider } from '@material-ui/core';\r\nimport { mapViewer } from '..';\r\nimport ZoomIn from '@material-ui/icons/ZoomIn';\r\nimport ZoomOut from '@material-ui/icons/ZoomOut';\r\n\r\ninterface ZoomSliderStates {\r\n\tscale: number;\r\n}\r\n\r\ninterface ZoomSliderProps {\r\n}\r\n\r\nconst ValueLabelComponent = (props) => {\r\n\tconst { children, open, value } = props;\r\n\treturn (\r\n\t\t<Tooltip open={open} enterTouchDelay={0} placement=\"top\" title={value + \"%\"}>\r\n\t\t\t{children}\r\n\t\t</Tooltip>\r\n\t);\r\n}\r\n\r\nexport class ZoomSlider extends React.Component<ZoomSliderProps, ZoomSliderStates> {\r\n\r\n\tconstructor(props: ZoomSliderProps, context?: any) {\r\n\t\tsuper(props, context);\r\n\t\tthis.state = {\r\n\t\t\tscale: 100\r\n\t\t};\r\n\t}\r\n\r\n\tzoom = (event, value) => {\r\n\t\tthis.setState({\r\n\t\t\tscale: Math.max(10, Math.min(300, value))\r\n\t\t});\r\n\t\tmapViewer.stage.scale.set(this.state.scale / 100, this.state.scale / 100);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"slider\" style={{ paddingLeft: \"5px\", paddingRight: '5px' }}>\r\n\t\t\t\t<IconButton className='button' title=\"縮小\" onClick={() => this.zoom(null, this.state.scale - 10)}>\r\n\t\t\t\t\t<ZoomOut style={{ color: \"hsl(0, 1%, 80%)\" }} />\r\n\t\t\t\t</IconButton>\r\n\t\t\t\t<Slider\r\n\t\t\t\t\tdefaultValue={100}\r\n\t\t\t\t\tvalue={this.state.scale}\r\n\t\t\t\t\taria-valuetext={\"Zoom In / Out\"}\r\n\t\t\t\t\taria-labelledby=\"discrete-slider\"\r\n\t\t\t\t\tvalueLabelDisplay=\"auto\"\r\n\t\t\t\t\tValueLabelComponent={ValueLabelComponent}\r\n\t\t\t\t\tmarks\r\n\t\t\t\t\ttrack=\"inverted\"\r\n\t\t\t\t\tmin={10}\r\n\t\t\t\t\tmax={300}\r\n\t\t\t\t\tstep={1}\r\n\t\t\t\t\tonChange={this.zoom}\r\n\t\t\t\t\tstyle={{ marginLeft: \"5px\", marginRight: '5px' }}\r\n\t\t\t\t/>\r\n\t\t\t\t<IconButton className='button' title=\"放大\" onClick={() => this.zoom(null, this.state.scale + 10)}>\r\n\t\t\t\t\t<ZoomIn style={{ color: \"hsl(0, 1%, 80%)\" }} />\r\n\t\t\t\t</IconButton>\r\n\t\t\t</div >\r\n\t\t);\r\n\t}\r\n}","export interface Action {\r\n    undo: Function,\r\n    redo: Function,\r\n    param?: {}\r\n}\r\n\r\n// store all records that can undo.\r\nexport const undoRecord: Array<Action> = [];\r\n\r\n// store all records that can redo.\r\nexport const redoRecord: Array<Action> = [];","import React, { Component } from 'react';\r\nimport { IconButton, Tooltip, Switch } from '@material-ui/core';\r\nimport Undo from '@material-ui/icons/Undo';\r\nimport Redo from '@material-ui/icons/Redo';\r\nimport { Action, undoRecord, redoRecord } from '../lib/undoRedo';\r\nimport { emitter } from '..';\r\nimport Help from '@material-ui/icons/Help';\r\ninterface Props {\r\n\r\n}\r\ninterface State {\r\n    physicsLayer: false\r\n}\r\n\r\nclass FunctionBar extends Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            physicsLayer: false\r\n        };\r\n    }\r\n\r\n    undo = (): void => {\r\n        if (!undoRecord.length) return;\r\n        let record: Action = undoRecord.pop();\r\n        record.undo(record.param);\r\n        redoRecord.push(record);\r\n        this.forceUpdate();\r\n    }\r\n\r\n    redo = (): void => {\r\n        if (!redoRecord.length) return;\r\n        let record: Action = redoRecord.pop();\r\n        record.redo(record.param);\r\n        undoRecord.push(record);\r\n        this.forceUpdate();\r\n    }\r\n\r\n    componentDidMount() {\r\n        emitter.on('undo/redo', this.updateButtonState);\r\n        emitter.on('physics_layer', this.updatePhysicsSate);\r\n    }\r\n\r\n    updateButtonState = () => {\r\n        this.forceUpdate();\r\n    }\r\n\r\n    updatePhysicsSate = (checked) => {\r\n        this.setState({ physicsLayer: checked });\r\n    }\r\n\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"function-bar\">\r\n                {/* <TextField style={{ marginLeft: '10px', marginRight: '10px' }} size=\"small\" defaultValue=\"unnamed_map.twmap\" placeholder=\"file name\" /> */}\r\n                <IconButton size=\"small\"\r\n                    style={{ marginLeft: '10px', marginRight: '10px' }}\r\n                    onClick={() => window.open('https://hackmd.io/@SakiOCVjRi6switvKe2CNw/twmap_editor_guideline', '_new')}>\r\n                    <Help />\r\n                </IconButton>\r\n                <div className=\"divider\"></div>\r\n                <IconButton size=\"small\" disabled={undoRecord.length === 0} style={{ marginLeft: '10px', marginRight: '10px' }} onClick={this.undo}>\r\n                    <Tooltip title=\"Undo\">\r\n                        <Undo />\r\n                    </Tooltip>\r\n                </IconButton>\r\n                <IconButton size=\"small\" disabled={redoRecord.length === 0} style={{ marginLeft: '10px', marginRight: '10px' }} onClick={this.redo}>\r\n                    <Tooltip title=\"redo\"><Redo /></Tooltip>\r\n                </IconButton>\r\n                <div className=\"divider\"></div>\r\n                <div>Physics layer:</div>\r\n                <Switch checked={this.state.physicsLayer} onChange={e => emitter.emit('physics_layer', e.target.checked)}></Switch>\r\n                <div className=\"divider\"></div>\r\n            </div >\r\n        )\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        emitter.off('undo/redo', this.updateButtonState);\r\n        emitter.off('physics_layer', this.updatePhysicsSate);\r\n    }\r\n}\r\n\r\nexport default FunctionBar;\r\n","import * as React from 'react';\r\nimport { ITabButtonProps } from './TabButton';\r\nexport interface IGroupButtonProps {\r\n    children?: React.ReactNode,\r\n    defaultValue?: string,\r\n    selectedStyle?: React.CSSProperties,\r\n    choose?: (alias: string, last: string) => void;\r\n}\r\n\r\nexport interface IGroupButtonState {\r\n    lastAlias: string\r\n}\r\n\r\nexport default class ButtonGroup extends React.Component<IGroupButtonProps & React.HTMLAttributes<HTMLDivElement>, IGroupButtonState> {\r\n    constructor(props: IGroupButtonProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            lastAlias: this.props.defaultValue\r\n        }\r\n    }\r\n\r\n    updateSelected(alias: string) {\r\n        this.props.choose && this.props.choose(alias, this.state.lastAlias)\r\n        this.setState({\r\n            lastAlias: alias\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className={this.props.className} id={this.props.id} style={this.props.style}>{\r\n                React.Children.map(this.props.children, (child: React.ReactElement<ITabButtonProps>, i: number) => {\r\n                    if (child.props.alias === this.state.lastAlias) {\r\n                        return (\r\n                            <div key={i} style={this.props.selectedStyle}\r\n                                onClick={this.updateSelected.bind(this, child.props.alias)}>\r\n                                {child}\r\n                            </div>\r\n                        );\r\n                    } else {\r\n                        return (\r\n                            <div key={i}\r\n                                onClick={this.updateSelected.bind(this, child.props.alias)}>\r\n                                {child}\r\n                            </div>\r\n                        );\r\n                    }\r\n                })\r\n            }</div>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\n\r\nexport interface ITabButtonProps {\r\n    alias: string\r\n}\r\n\r\nexport interface ITabButtonState {\r\n}\r\n\r\nexport default class TabButton extends React.Component<ITabButtonProps & React.HTMLAttributes<HTMLDivElement>, ITabButtonState> {\r\n    constructor(props: ITabButtonProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className={this.props.className} id={this.props.id} style={this.props.style}>{this.props.children}</div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\nimport './css/menuBody.css';\r\nimport './css/base.css';\r\nimport { ImageTileManager } from '../lib/ImageTileManager';\r\nimport { loadMaterial } from './loadMaterial';\r\nimport { materialClick } from './materialClick';\r\nimport { ZoomSlider } from './ZoomSlider';\r\nimport FunctionBar from './FunctionBar';\r\nimport { emitter } from '..';\r\nimport ButtonGroup from './ButtonGroup';\r\nimport TabButton from './TabButton';\r\nimport { CircularProgress } from '@material-ui/core';\r\nimport deleteTWTile from './deleteTWTile.json'\r\n\r\n/**\r\n * 我是命運，我先寫一下有什麼是想你做的／之後我會做的：\r\n * \r\n * 計算點和點之間的路線，你現在看到的路線是假的，只是我一個一個弄出來\r\n * 輸出地圖功能，之後我會在EditableMap的class加一個叫exportTOTWMAP，直接叫它就可以拿到資料\r\n * 一開始的加載地圖／建立新地圖的介面，這個可以先弄，但別React.renderComponent，因為每次測試也要點按鈕，很煩\r\n * 按數字鍵可以切換不同的圖片，換而言之，你要弄一個介面設定快捷鍵，這東西我弄\r\n * 幫我美化一下ZoomSlider\r\n * css的命名方法是xxx-xxx，比如zoom-slider，快把你的命名改掉\r\n * 幫我問小哈拿地圖物件的資料，比如屋子是怎組成之類\r\n * \r\n * 我看地圖編輯器功能應該不只以上的吧，比起做出以前的編輯器，不如想想你有什麼新功能想做，告訴我之後可以幫你做出來\r\n */\r\ninterface MenuProps {\r\n\tmanager: ImageTileManager,\r\n}\r\n\r\ninterface MenuState {\r\n\tmaterialImage: Array<String>,\r\n\tmaterialPosition: Array<Object>,\r\n\tsettingPanel: boolean,\r\n\tloaded: boolean\r\n}\r\n\r\nexport class Menu extends React.Component<MenuProps, MenuState> {\r\n\r\n\tconstructor(props: MenuProps, context?: any) {\r\n\t\tsuper(props, context);\r\n\t\tthis.state = { materialImage: [], materialPosition: [], settingPanel: false, loaded: false };\r\n\t\tloadMaterial(this.props.manager, this.state.materialImage, this.state.materialPosition).then(() => {\r\n\t\t\tthis.setState({\r\n\t\t\t\tloaded: true\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"app-layout\">\r\n\t\t\t\t<FunctionBar />\r\n\t\t\t\t<div className='menu-body' id='menu-body'>\r\n\r\n\t\t\t\t\t<ButtonGroup className='page-title'\r\n\t\t\t\t\t\tselectedStyle={{ background: '#424242' }}\r\n\t\t\t\t\t\tdefaultValue={\"built-in\"}\r\n\t\t\t\t\t\tchoose={(alias: string, last: string) => {\r\n\t\t\t\t\t\t\tconsole.log(alias);\r\n\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t<TabButton className='button' alias=\"built-in\">內建</TabButton>\r\n\t\t\t\t\t\t<TabButton className='button' alias=\"custom\">自訂</TabButton>\r\n\t\t\t\t\t\t<TabButton className='button' alias=\"common\">常用</TabButton>\r\n\t\t\t\t\t</ButtonGroup>\r\n\r\n\t\t\t\t\t<ButtonGroup className='classification-title'\r\n\t\t\t\t\t\tselectedStyle={{ background: '#424242' }}\r\n\t\t\t\t\t\tdefaultValue={\"floor\"}\r\n\t\t\t\t\t\tchoose={(alias: string, last: string) => {\r\n\t\t\t\t\t\t\tconsole.log(alias);\r\n\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t<TabButton className='button' alias=\"floor\">地板</TabButton>\r\n\t\t\t\t\t\t<TabButton className='button' alias=\"wall\">牆壁</TabButton>\r\n\t\t\t\t\t\t<TabButton className='button' alias=\"object\">物件</TabButton>\r\n\t\t\t\t\t\t<TabButton className='button' alias=\"group\">群組</TabButton>\r\n\t\t\t\t\t</ButtonGroup>\r\n\r\n\t\t\t\t\t<div className='material-box'>\r\n\t\t\t\t\t\t{this.state.loaded ?\r\n\t\t\t\t\t\t\tthis.state.materialPosition.map((data: any, idx) => {\r\n\t\t\t\t\t\t\t\tif (deleteTWTile.removeAt.split(',')[idx] != '1')\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t<div className='material-image-box button'\r\n\t\t\t\t\t\t\t\t\t\t\tid={`material-image-box${idx}`}\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={materialClick.bind(this, `material-image-box${idx}`)} key={idx}>\r\n\t\t\t\t\t\t\t\t\t\t\t<img alt=\"tile set\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => emitter.emit('selected_tile', idx)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={this.state.materialImage[data.imgIdx].toString()}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdraggable=\"false\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ marginLeft: `${data.imgLeft}px`, marginTop: `${data.imgTop}px` }}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t}) : <div style={{ margin: 'auto' }}>\r\n\t\t\t\t\t\t\t\t<CircularProgress />\r\n\t\t\t\t\t\t\t</div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<ZoomSlider />\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default Menu;\r\n","import React from 'react';\r\nimport Menu from './component/Menu';\r\nimport { manager } from '.';\r\nimport { ThemeProvider, createMuiTheme } from '@material-ui/core';\r\n\r\nconst theme = createMuiTheme({ \"palette\": { \"type\": 'dark', \"common\": { \"black\": \"#000\", \"white\": \"#fff\" }, \"background\": { \"paper\": \"rgba(30, 30, 30, 1)\", \"default\": \"rgba(74, 74, 74, 1)\" }, \"primary\": { \"light\": \"#7986cb\", \"main\": \"rgba(114, 123, 172, 1)\", \"dark\": \"rgba(122, 193, 129, 1)\", \"contrastText\": \"#fff\" }, \"secondary\": { \"light\": \"#ff4081\", \"main\": \"#f50057\", \"dark\": \"#c51162\", \"contrastText\": \"#fff\" }, \"error\": { \"light\": \"#e57373\", \"main\": \"#f44336\", \"dark\": \"#d32f2f\", \"contrastText\": \"#fff\" }, \"text\": { \"primary\": \"rgba(255, 255, 255, 0.87)\", \"secondary\": \"rgba(0, 0, 0, 0.54)\", \"disabled\": \"rgba(0, 0, 0, 0.38)\", \"hint\": \"rgba(0, 0, 0, 0.38)\" } } }\r\n);\r\n\r\nfunction App() {\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <Menu manager={manager} />\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js';\r\n\r\nexport class ImageTileManager {\r\n    collections: PIXI.Texture[][] = [];\r\n\r\n    /**\r\n     * 建立一個圖片切割及圖片管理器。\r\n     * \r\n     * @param {string[]} images 圖片的url\r\n     */\r\n    constructor(public images: string[]) { };\r\n\r\n    async loadTexture(): Promise<void> {\r\n        await new Promise(r => {\r\n            this.images.forEach(async (e: string, i: number): Promise<void> => {\r\n                let mapTexture: PIXI.Sprite = PIXI.Sprite.from(e);\r\n                let collection: PIXI.Texture[] = [];\r\n                let height: number = mapTexture.height;\r\n                let width: number = mapTexture.width;\r\n                for (let y: number = 0; y < height; y += 32) {\r\n                    for (let x: number = 0; x < width; x += 32) {\r\n                        collection.push(new PIXI.Texture(mapTexture.texture.baseTexture, new PIXI.Rectangle(x, y, 32, 32)));\r\n                    }\r\n                }\r\n                mapTexture.destroy();\r\n                this.collections.push(collection);\r\n            });\r\n            r();\r\n        });\r\n    }\r\n}\r\n\r\n","import * as PIXI from 'pixi.js';\r\n\r\nenum PointSystem {\r\n    PIXI, // PIXI系統\r\n    MAP // 地圖座標系統\r\n}\r\n\r\nexport class MapPoint extends PIXI.Point {\r\n\r\n    /**\r\n     * 創建一個點，支援用不同的系統表達數據。\r\n     * @param x x坐標\r\n     * @param y y坐標\r\n     * @param sys 代表系統\r\n     */\r\n    constructor(x: number, y: number, public sys: PointSystem = PointSystem.PIXI) {\r\n        super(x, y);\r\n    }\r\n\r\n    /**\r\n     * 從 PIXI.Point 建立一個 MapPoint。\r\n     * @param point 一個PIXI.Point\r\n     */\r\n    static fromPoint(point: PIXI.Point): MapPoint {\r\n        return new MapPoint(point.x, point.y);\r\n    }\r\n\r\n    /**\r\n     * 改變成為Tiled Map系統。\r\n     * @return new MapPoint with tiled map system\r\n     */\r\n    public toMapSys(): MapPoint {\r\n        if (this.sys === PointSystem.MAP) return this;\r\n        return new MapPoint(Math.floor(this.x / 32), Math.floor(this.y / 32), PointSystem.MAP);\r\n    }\r\n\r\n    /**\r\n     * 改變成為pixi系統。\r\n     * @return new MapPoint with pixi system\r\n     */\r\n    public toPIXISys(): MapPoint {\r\n        if (this.sys === PointSystem.PIXI) return this;\r\n        return new MapPoint(this.x * 32, this.y * 32);\r\n    }\r\n\r\n    /**\r\n     * 偏移本來的座標。\r\n     * @param x the offset of x coordinate\r\n     * @param y the offset of y coordinate\r\n     */\r\n    addXY(x: number | MapPoint, y: number): MapPoint {\r\n        if (x instanceof MapPoint) {\r\n            x = x as MapPoint;\r\n            y = x.y;\r\n            x = x.x;\r\n        }\r\n        return new MapPoint(this.x + x, this.y + y, this.sys);\r\n    }\r\n\r\n    /**\r\n     * 計算本點和目標點的距離。\r\n     * @param x 目標點的x座標，或者是一個點\r\n     * @param y 目標點的y座標\r\n     */\r\n    distanceTo(x: number | MapPoint, y?: number): number {\r\n        if (x instanceof MapPoint) {\r\n            x = x as MapPoint;\r\n            y = x.y;\r\n            x = x.x;\r\n        }\r\n        return Math.sqrt(Math.pow(this.x - x, 2) + Math.pow(this.y - y, 2));\r\n    }\r\n}\r\n","import * as PIXI from 'pixi.js';\r\n\r\nconst physicsVisualization: number[] = [\r\n    0xf5f5f5,\r\n    0xd4e157,\r\n    0x26a69a,\r\n    0x42a5f5\r\n];\r\n\r\nexport class TileSprite extends PIXI.Sprite {\r\n\r\n    constructor(texture: PIXI.Texture, public r: number | string, public i: number, public layer: number) {\r\n        super(texture);\r\n    }\r\n\r\n    static highestLayer(sprite: TileSprite[]): number {\r\n        let highest: number = 0;\r\n        for (let i = sprite.length - 1; i >= 0; --i) {\r\n            if (sprite[i].layer > highest) highest = sprite[i].layer;\r\n        }\r\n\r\n        return highest;\r\n    }\r\n\r\n    toPhysicsTile(): PhysicsTile {\r\n        let phyTile: PhysicsTile = new PhysicsTile(this.layer);\r\n        phyTile.interactive = true;\r\n        phyTile.position = this.position;\r\n        return phyTile;\r\n    }\r\n}\r\n\r\nexport class PhysicsTile extends PIXI.Graphics {\r\n    private _layer: number;\r\n\r\n    constructor(layer: number) {\r\n        super();\r\n        this.layer = layer;\r\n    }\r\n\r\n    private updateColor(): void {\r\n        this.clear();\r\n        let layer: number = this.layer + 1;\r\n        let color: number;\r\n        if (layer % 1 === 0) {\r\n            color = physicsVisualization[layer];\r\n        } else {\r\n            color = (physicsVisualization[Math.ceil(layer)] + physicsVisualization[Math.floor(layer)]) / 2;\r\n        }\r\n        this.lineStyle(3, color, 0.5);\r\n        this.beginFill(color, 0.3);\r\n        this.drawRect(0, 0, 32, 32);\r\n        this.endFill();\r\n    }\r\n\r\n    public get layer(): number {\r\n        return this._layer;\r\n    }\r\n\r\n    public set layer(layer: number) {\r\n        this._layer = layer;\r\n        this.updateColor();\r\n    }\r\n}","export enum KeyAction {\r\n  PRESS,\r\n  DOWN,\r\n  RELEASE\r\n}\r\n\r\ninterface ShortcutEvent {\r\n  keyCode: number[],\r\n  callback: () => void,\r\n  action: KeyAction\r\n}\r\n\r\nexport class ShortcutManager {\r\n  private _registeredEvent = {} as ShortcutEvent;\r\n  private _triggerHistory = {} as boolean;\r\n  private _keyCollection = {};\r\n  private _keyActionHistory = {};\r\n\r\n  constructor() {\r\n    document.addEventListener('keypress', (e) => {\r\n      if (e.keyCode in this._keyCollection) {\r\n        this._keyActionHistory[e.keyCode] = true;\r\n        e.preventDefault();\r\n        outter: for (let code in this._registeredEvent) {\r\n          let event: ShortcutEvent = this._registeredEvent[code];\r\n          for (let keyid of event.keyCode) {\r\n            if (!this._keyActionHistory[keyid]) {\r\n              this._triggerHistory[code] = false;\r\n              continue outter;\r\n            }\r\n          }\r\n          if (event.action === KeyAction.PRESS && this._triggerHistory[code])\r\n            continue;\r\n          this._triggerHistory[code] = true;\r\n          event.callback();\r\n        }\r\n      }\r\n    });\r\n\r\n    document.addEventListener('keyup', e => {\r\n      delete this._keyActionHistory[e.keyCode];\r\n    });\r\n  }\r\n\r\n  public on(code: string, keyCode: number[], callback: () => void, action: KeyAction = KeyAction.DOWN): string {\r\n    keyCode.forEach((e, i) => {\r\n      if (e in this._keyCollection)\r\n        this._keyCollection[e]++;\r\n      else\r\n        this._keyCollection[e] = 1;\r\n    });\r\n\r\n    this._registeredEvent[code] = {\r\n      keyCode: keyCode,\r\n      callback: callback,\r\n      action: action\r\n    }\r\n    this._triggerHistory[code] = false;\r\n    return code;\r\n  }\r\n\r\n  public off(code: string): void {\r\n    this._registeredEvent[code].keyCode.forEach((e, i) => {\r\n      if (this._keyCollection[e] === 1)\r\n        delete this._keyCollection[e];\r\n      else\r\n        this._keyCollection[e]--;\r\n    });\r\n    delete this._registeredEvent[code];\r\n    delete this._triggerHistory[code];\r\n  }\r\n}\r\n\r\nexport const shortcutManager: ShortcutManager = new ShortcutManager();","import { emitter } from '..';\r\nimport { TileSprite, PhysicsTile } from './TileSprite';\r\nimport { MapPoint } from './MapPoint';\r\nimport { shortcutManager } from './ShortcutManager';\r\nimport { ImageTileManager } from './ImageTileManager';\r\nimport { DraggingChecker } from './DraggingCheck';\r\nimport { Key } from './key';\r\nimport * as PIXI from 'pixi.js';\r\n\r\nexport interface MapData {\r\n    rows: number,\r\n    tiles: Object,\r\n    objects: Object,\r\n    rsrcs: Object,\r\n    tileW: number,\r\n    cols: number,\r\n    tileH: number,\r\n    layers: Array<Object>\r\n}\r\n\r\nexport interface Tile {\r\n    r: string,\r\n    i: number,\r\n    layer?: number\r\n}\r\n\r\nexport enum Click {\r\n    LEFT,\r\n    RIGHT\r\n}\r\n\r\nexport class EditableMap extends PIXI.Container {\r\n    private _tile: PIXI.Container = new PIXI.Container(); // 地圖圖片\r\n    private physicsLayer: PIXI.Container = new PIXI.Container(); // 用於顯示地圖物理佈局\r\n    private _showPhysics: boolean = false;\r\n    private _editableTile: Map<string, TileSprite[]> = new Map<string, TileSprite[]>();\r\n    private _editablePhysics: Map<string, PhysicsTile> = new Map<string, PhysicsTile>();\r\n    private _hoverGraphics: PIXI.Graphics;\r\n    private _lastCursorPos: PIXI.Point;\r\n    private _startDrag: MapPoint;\r\n    private _draggingChecker: DraggingChecker;\r\n    private _draggingArea: PIXI.Graphics = new PIXI.Graphics();\r\n\r\n\t/**\r\n\t * 當格子被按下時，要呼叫的function。\r\n\t * \r\n\t * @param {number} x 被按下格子的x\r\n\t * @param {number} y 被按下格子的y\r\n\t */\r\n    public onClick: (x: number, y: number, clickType: Click) => void = null;\r\n\r\n\t/**\r\n\t * 拖動動作結束時會被呼叫的function。\r\n\t * \r\n\t * @param {number} x1 起始拖動點的x坐標\r\n\t * @param {number} y1 起始拖動點的y坐標\r\n\t * @param {number} x2 結束拖動點的x坐標\r\n\t * @param {number} y2 結束拖動點的y坐標\r\n\t */\r\n    public onDrag: (x1: number, y1: number, x2: number, y2: number) => void = null;\r\n\r\n    constructor(public imageSet: ImageTileManager, public mapWidth: number, public mapHeight: number, public groundTile: Tile, data?: MapData) {\r\n        super();\r\n        this._draggingChecker = new DraggingChecker(this);\r\n        this.cursor = 'none';\r\n        this.addChild(this._tile);\r\n        this._hoverGraphics = new PIXI.Graphics();\r\n        this._hoverGraphics.beginFill(0xFFFFFF, 0.5)\r\n            .lineStyle(3, 0xFFFFF, 1)\r\n            .drawRect(0, 0, 32, 32)\r\n            .endFill();\r\n\r\n        this.on('mousemove', (e: PIXI.interaction.InteractionEvent) => {\r\n            this._lastCursorPos = e.data.getLocalPosition(this);\r\n            this._updateCursor();\r\n            if (this._draggingChecker.dragging) {\r\n                this._startDrag = MapPoint.fromPoint(this._draggingChecker.draggingPoint).toMapSys();\r\n                this._updateSelectedArea();\r\n            }\r\n        });\r\n\r\n        this.on('mouseup', (e: PIXI.interaction.InteractionEvent) => {\r\n            let c: MapPoint = MapPoint.fromPoint(e.data.getLocalPosition(this))\r\n                .addXY(-this._tile.x, -this._tile.y)\r\n                .toMapSys();\r\n            if (e.data.originalEvent.which === 2) {\r\n                this.onClick && this.onClick(c.x, c.y, Click.RIGHT);\r\n            } else if (this._startDrag) {\r\n                this.removeChild(this._draggingArea);\r\n                let min = {\r\n                    x: Math.max(0, Math.min(this._startDrag.x, c.x)),\r\n                    y: Math.max(0, Math.min(this._startDrag.y, c.y))\r\n                };\r\n                let max = {\r\n                    x: Math.min(Math.max(c.x, this._startDrag.x), this.mapWidth - 1),\r\n                    y: Math.min(Math.max(c.y, this._startDrag.y), this.mapHeight - 1)\r\n                };\r\n                this.onDrag && this.onDrag(min.x, min.y, max.x, max.y);\r\n                this._startDrag = null;\r\n            } else {\r\n                // normal click\r\n                this.onClick && this.onClick(c.x, c.y, Click.LEFT);\r\n            }\r\n        });\r\n\r\n        this.on('rightclick', (e: PIXI.interaction.InteractionEvent) => {\r\n            console.log('right');\r\n            let result: MapPoint = MapPoint.fromPoint(e.data.getLocalPosition(this))\r\n                .addXY(-this._tile.x, -this._tile.y)\r\n                .toMapSys();\r\n            this.onClick && this.onClick(result.x, result.y, Click.LEFT);\r\n        });\r\n\r\n        if (data) {\r\n            // load map\r\n            for (let layer of data['layers']) {\r\n                for (let tileData in layer['tiles']) {\r\n                    const tileSaver: TileSprite[] = this._editableTile[tileData] === undefined ?\r\n                        this._editableTile[tileData] = [] : this._editableTile[tileData];\r\n\r\n                    const loc: string[] = tileData.split(',');\r\n                    const pos: number[] = [parseInt(loc[0]), parseInt(loc[1])];\r\n                    const ri = layer['tiles'][tileData];\r\n                    const layerLevel = data['tiles'][tileData]['layer'];\r\n                    const tile: TileSprite = this._createImageTile(pos[0], pos[1], ri['r'], ri['i'], layerLevel);\r\n                    tileSaver.push(tile);\r\n                    this._tile.addChild(tile);\r\n\r\n                    const phyTile: PhysicsTile = tile.toPhysicsTile();\r\n                    // TODO: add event of clicking physics tile\r\n\r\n                    this._editablePhysics[tileData] = phyTile;\r\n                    this.physicsLayer.addChild(phyTile);\r\n                }\r\n            }\r\n        } else {\r\n            // create map\r\n        }\r\n        this._shortcutConfig();\r\n    }\r\n\r\n\t/**\r\n\t * 從JSON創建可編輯的地圖。\r\n\t * \r\n\t * @param {ImageTileManager} imageSet 在地圖中使用的圖像集\r\n\t * @param {MapData} json json數據\r\n\t * \r\n\t * @return {EditableMap} 可編輯的地圖\r\n\t */\r\n    static fromJSON(imageSet: ImageTileManager, json: MapData): EditableMap {\r\n        return new EditableMap(imageSet, json.cols, json.rows, { r: '0', i: 63, layer: 1 }, json);\r\n    }\r\n\r\n    private _shortcutConfig() {\r\n        shortcutManager.on('A', [Key.A], () => this._shiftMap({ x: 30 }));\r\n        shortcutManager.on('D', [Key.D], () => this._shiftMap({ x: -30 }));\r\n        shortcutManager.on('W', [Key.W], () => this._shiftMap({ y: 30 }));\r\n        shortcutManager.on('S', [Key.S], () => this._shiftMap({ y: -30 }));\r\n        emitter.on('physics_layer', this._switchPhysicsLayer.bind(this));\r\n\r\n    }\r\n\r\n    private _switchPhysicsLayer(checked: boolean) {\r\n        this.showPhysicsLayer = checked;\r\n    }\r\n\r\n    private _shiftMap(offset: Object): void {\r\n        if (offset['x']) {\r\n            this.pivot.x -= offset['x'];\r\n            if (this._lastCursorPos)\r\n                this._lastCursorPos.x -= offset['x'];\r\n        }\r\n        if (offset['y']) {\r\n            this.pivot.y -= offset['y'];\r\n            if (this._lastCursorPos)\r\n                this._lastCursorPos.y -= offset['y'];\r\n        }\r\n        if (this._lastCursorPos) this._updateCursor();\r\n        if (this._startDrag) this._updateSelectedArea();\r\n    }\r\n\r\n    private _correctPoint(point: PIXI.Point | MapPoint): MapPoint {\r\n        return new MapPoint(\r\n            Math.max(0, Math.min(point.x - point.x % 32, (this.mapWidth - 1) * 32)),\r\n            Math.max(0, Math.min(point.y - point.y % 32, (this.mapHeight - 1) * 32))\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update grid cursor position.\r\n     */\r\n    private _updateCursor() {\r\n        let cursor: MapPoint = this._correctPoint(this._lastCursorPos);\r\n        this._hoverGraphics.position.set(cursor.x, cursor.y);\r\n    }\r\n\r\n    /**\r\n     * Update, and visualize selected area.\r\n     */\r\n    private _updateSelectedArea() {\r\n        let tem = MapPoint.fromPoint(this._lastCursorPos).toMapSys();\r\n        let min = {\r\n            x: Math.max(0, Math.min(tem.x, this._startDrag.x)),\r\n            y: Math.max(0, Math.min(tem.y, this._startDrag.y))\r\n        };\r\n        let max = {\r\n            x: Math.min(Math.max(tem.x, this._startDrag.x), this.mapWidth - 1),\r\n            y: Math.min(Math.max(tem.y, this._startDrag.y), this.mapHeight - 1)\r\n        };\r\n        this._draggingArea.destroy();\r\n        this._draggingArea = new PIXI.Graphics();\r\n        this._draggingArea.lineStyle(3, 0xFFFFFF, 1)\r\n            .beginFill(0xFFFFFF, 0.3)\r\n            .drawRect(0, 0, (max.x - min.x + 1) * 32,\r\n                (max.y - min.y + 1) * 32)\r\n            .endFill();\r\n        this._draggingArea.position.set(min.x * 32, min.y * 32);\r\n        this.addChild(this._draggingArea);\r\n\r\n    }\r\n\r\n    /**\r\n     * Create a PIXI.Sprite which represent the image tile.\r\n     * @param x x coordinate\r\n     * @param y y coordinate\r\n     * @param r which image set\r\n     * @param i the index of grid\r\n     */\r\n    private _createImageTile(x: number, y: number, r: string | number, i: number, layer: number): TileSprite {\r\n        let image: TileSprite = new TileSprite(this.imageSet.collections[r][i], r, i, layer - 1);\r\n        image.position.set(x * 32, y * 32);\r\n        image.interactive = true;\r\n        image.on('rightclick', e => {\r\n            if (this.onClick != null)\r\n                this.onClick(x, y, Click.RIGHT);\r\n        });\r\n        return image;\r\n    }\r\n\r\n    /**\r\n     * Pass a region and export the region as map object.\r\n     * @param x1 x coordinate of starting position\r\n     * @param y1 y coordinate of starting position\r\n     * @param x2 x coordinate of ending position\r\n     * @param y2 y coordinate of ending position\r\n     */\r\n    public exportMapObject(x1: number, y1: number, x2: number, y2: number): Array<Object> {\r\n        let obj: Array<Object> = [];\r\n\r\n        for (let x: number = x1; x <= x2; x++) {\r\n            for (let y: number = y1; y <= y2; y++) {\r\n                const index: string = x + ',' + y;\r\n                const spriteList: Array<TileSprite> = this._editableTile[index];\r\n                const topTile: TileSprite = spriteList[spriteList.length - 1];\r\n                obj.push({\r\n                    offset: {\r\n                        x: x - x1,\r\n                        y: y - y1\r\n                    },\r\n                    r: topTile.r.toString(),\r\n                    i: topTile.i,\r\n                    layer: topTile.layer\r\n                });\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n\r\n\t/**\r\n\t * delete object or tile on given point.\r\n\t * \r\n\t * @param {number} x x coordinate of the point\r\n\t * @param {number} y y coordinate of the point\r\n\t */\r\n    public delete(x: number, y: number): void {\r\n        let list: TileSprite[] = this._editableTile[x + ',' + y];\r\n        if (list.length === 1) return;\r\n\r\n        let last: TileSprite = list.pop();\r\n        this._tile.removeChild(last);\r\n        this._editablePhysics[x + ',' + y].layer = list[list.length - 1].layer;\r\n    }\r\n\r\n\t/**\r\n\t * stack a tile on map.\r\n     * Please note that, if you stack a tile which is the same as the last one, it will stack nothings.\r\n\t * \r\n\t * @param {number} x x coordinate of the point\r\n\t * @param {number} y y coordinate of the point\r\n\t * @param {Tile} tile tile data\r\n\t */\r\n    public stack(x: number, y: number, tile: Tile): boolean {\r\n        if (x >= this.mapWidth || y >= this.mapHeight || x < 0 || y < 0) return false;\r\n        let last: TileSprite = this._editableTile[x + ',' + y][this._editableTile[x + ',' + y].length - 1];\r\n        if (last.r === tile.r && last.i === tile.i) return false;\r\n        let image: TileSprite = this._createImageTile(x, y, tile.r, tile.i, tile.layer);\r\n        this._editableTile[x + ',' + y].push(image);\r\n        this._editablePhysics[x + ',' + y].layer = tile.layer;\r\n\r\n        this._tile.addChild(image);\r\n        return true;\r\n    }\r\n\r\n\t/**\r\n\t * Visualize physics layer of map.\r\n\t */\r\n    public set showPhysicsLayer(set: boolean) {\r\n        this._showPhysics = set;\r\n        this._showPhysics ? this.addChild(this.physicsLayer) : this.removeChild(this.physicsLayer);\r\n    }\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n    public get showPhysicsLayer() {\r\n        return this._showPhysics;\r\n    }\r\n\r\n    public set showHoverEffect(set: boolean) {\r\n        set ? this.addChild(this._hoverGraphics) : this.removeChild(this._hoverGraphics);\r\n    }\r\n\r\n    public exportToTWMAP(): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            let map: MapData = {} as MapData;\r\n            map.rows = this.mapHeight;\r\n            map.cols = this.mapWidth;\r\n            map.objects = {};\r\n            map.tileW = map.tileH = 32;\r\n\r\n        });\r\n    }\r\n\r\n    public dsipose(): void {\r\n        shortcutManager.off('A');\r\n        shortcutManager.off('S');\r\n        shortcutManager.off('W');\r\n        shortcutManager.off('D');\r\n        emitter.off('physics_layer', this._switchPhysicsLayer);\r\n        this.destroy();\r\n    }\r\n}\r\n","import * as PIXI from 'pixi.js';\r\n\r\nexport class DraggingChecker {\r\n    private _startChecking: boolean = false;\r\n    public draggingPoint: PIXI.Point;\r\n    public dragging: boolean = false;\r\n\r\n    constructor(public draggableObject: PIXI.DisplayObject) {\r\n        this.draggingPoint = new PIXI.Point();\r\n        draggableObject.interactive = true;\r\n        draggableObject.on('mousedown', (e) => {\r\n            this.draggingPoint = e.data.getLocalPosition(this.draggableObject);\r\n            this._startChecking = true;\r\n        });\r\n\r\n        draggableObject.on('mousemove', (e) => {\r\n            if (!this._startChecking) return;\r\n            let c: PIXI.Point = e.data.getLocalPosition(this.draggableObject);\r\n            if (!this.dragging && (Math.abs(c.x - this.draggingPoint.x) > 10 || Math.abs(c.y - this.draggingPoint.y) > 10))\r\n                this.dragging = this._startChecking;\r\n        });\r\n\r\n        draggableObject.on('mouseup', (e) => {\r\n            this.dragging = this._startChecking = false;\r\n        });\r\n    }\r\n}\r\n","export const Key = {\r\n    BACKSPACE: 8,\r\n    TAB: 9,\r\n    ENTER: 13,\r\n    SHIFT: 16,\r\n    PAUSE: 19,\r\n    CTRL: 17,\r\n    ALT: 18,\r\n    CAPS_LOCK: 20,\r\n    ESCAPE: 27,\r\n    SPACE: 32,\r\n    PAGE_UP: 33,\r\n    PAGE_DOWN: 34,\r\n    END: 35,\r\n    HOME: 36,\r\n    LEFT: 37,\r\n    UP: 38,\r\n    RIGHT: 39,\r\n    DOWN: 40,\r\n    PRINT_SCREEN: 44,\r\n    INSERT: 45,\r\n    DELETE: 46,\r\n    _0: 48,\r\n    _1: 49,\r\n    _2: 50,\r\n    _3: 51,\r\n    _4: 52,\r\n    _5: 53,\r\n    _6: 54,\r\n    _7: 55,\r\n    _8: 56,\r\n    _9: 57,\r\n    A: 65,\r\n    B: 66,\r\n    C: 67,\r\n    D: 68,\r\n    E: 69,\r\n    F: 70,\r\n    G: 71,\r\n    H: 72,\r\n    I: 73,\r\n    J: 74,\r\n    K: 75,\r\n    L: 76,\r\n    M: 77,\r\n    N: 78,\r\n    O: 79,\r\n    P: 80,\r\n    Q: 81,\r\n    R: 82,\r\n    S: 83,\r\n    T: 84,\r\n    U: 85,\r\n    V: 86,\r\n    W: 87,\r\n    X: 88,\r\n    Y: 89,\r\n    Z: 90,\r\n    CMD: 91,\r\n    CMD_RIGHT: 93,\r\n    NUM_0: 96,\r\n    NUM_1: 97,\r\n    NUM_2: 98,\r\n    NUM_3: 99,\r\n    NUM_4: 100,\r\n    NUM_5: 101,\r\n    NUM_6: 102,\r\n    NUM_7: 103,\r\n    NUM_8: 104,\r\n    NUM_9: 105,\r\n    MULTIPLY: 106,\r\n    ADD: 107,\r\n    SUBTRACT: 109,\r\n    DECIMAL_POINT: 110,\r\n    DIVIDE: 111,\r\n    F1: 112,\r\n    F2: 113,\r\n    F3: 114,\r\n    F4: 115,\r\n    F5: 116,\r\n    F6: 117,\r\n    F7: 118,\r\n    F8: 119,\r\n    F9: 120,\r\n    F10: 121,\r\n    F11: 122,\r\n    F12: 123,\r\n    NUM_LOCK: 144,\r\n    SCROLL_LOCK: 145,\r\n    SEMI_COLON: 186,\r\n    EQUAL: 187,\r\n    COMMA: 188,\r\n    DASH: 189,\r\n    PERIOD: 190,\r\n    FORWARD_SLASH: 191,\r\n    OPEN_BRACKET: 219,\r\n    BACK_SLASH: 220,\r\n    CLOSE_BRACKET: 221,\r\n    SINGLE_QUOTE: 222\r\n};\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\nimport { ImageTileManager } from './lib/ImageTileManager';\r\nimport * as PIXI from 'pixi.js';\r\nimport tileset_0 from './assets/tileset_0.png';\r\nimport tileset_1 from './assets/tileset_1.png';\r\nimport tileset_2 from './assets/tileset_2.png';\r\nimport tileset_3 from './assets/tileset_3.png';\r\nimport tileset_4 from './assets/tileset_4.png';\r\nimport tileset_5 from './assets/tileset_5.png';\r\nimport tileset_6 from './assets/tileset_6.png';\r\nimport tileset_7 from './assets/tileset_7.png';\r\nimport tileset_8 from './assets/tileset_8.png';\r\nimport tileset_9 from './assets/tileset_9.png';\r\nimport jsonData from './assets/decoded.json';\r\nimport { EditableMap, Click } from './lib/EditableMap';\r\nimport { Action, undoRecord, redoRecord } from './lib/undoRedo';\r\nimport { shortcutManager } from './lib/ShortcutManager';\r\nimport { Key } from './lib/key';\r\nimport hotkeys from 'hotkeys-js';\r\nimport { deepFreeze } from './lib/DeepFreeze';\r\nimport MapObjects from './assets/object_group.json';\r\n\r\n// manage the relationship between alias and data.\r\nexport let resourceList = {\r\n    'tileset_0': tileset_0,\r\n    'tileset_1': tileset_1,\r\n    'tileset_2': tileset_2,\r\n    'tileset_3': tileset_3,\r\n    'tileset_4': tileset_4,\r\n    'tileset_5': tileset_5,\r\n    'tileset_6': tileset_6,\r\n    'tileset_7': tileset_7,\r\n    'tileset_8': tileset_8,\r\n    'tileset_9': tileset_9,\r\n};\r\n\r\nexport const download = (data, fileAlias, type) => {\r\n    let file: Blob = new Blob([data], { type: type });\r\n    let a: HTMLAnchorElement = document.createElement('a');\r\n    let url: string = URL.createObjectURL(file);\r\n    a.href = url;\r\n    a.download = fileAlias;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    window.URL.revokeObjectURL(url);\r\n}\r\n\r\nexport const emitter: PIXI.utils.EventEmitter = new PIXI.utils.EventEmitter();\r\nexport const loader = PIXI.Loader.shared;\r\nexport const mapViewer: PIXI.Application = new PIXI.Application({\r\n    width: window.innerWidth,\r\n    height: window.innerHeight\r\n});\r\nmapViewer.view.style.overflow = 'hidden';\r\nmapViewer.view.style.zIndex = \"-1\";\r\nmapViewer.renderer.autoDensity = true;\r\nmapViewer.view.oncontextmenu = () => false;\r\n\r\nwindow.onresize = () => {\r\n    mapViewer.renderer.resize(window.innerWidth, window.innerHeight);\r\n}\r\n\r\nexport let manager: ImageTileManager;\r\n\r\nfor (let r in resourceList) {\r\n    loader.add(r, resourceList[r]);\r\n}\r\n\r\nlet selected = 63;\r\n\r\nemitter.on('selected_tile', (id: number) => {\r\n    selected = id;\r\n});\r\n\r\nloader.load((loader, resources) => {\r\n    document.body.appendChild(mapViewer.view);\r\n\r\n    manager = new ImageTileManager(['tileset_0']);\r\n\r\n    manager.loadTexture().then(() => {\r\n        let myMap: EditableMap = EditableMap.fromJSON(manager, jsonData);\r\n        myMap.showHoverEffect = true;\r\n\r\n        shortcutManager.on('physics', [Key.V], () => {\r\n            myMap.showPhysicsLayer = !myMap.showPhysicsLayer;\r\n            emitter.emit('physics_layer', myMap.showPhysicsLayer);\r\n        });\r\n\r\n        hotkeys('ctrl+z, command+z', () => {\r\n            if (!undoRecord.length) return;\r\n            let record: Action = undoRecord.pop();\r\n            record.undo(record.param);\r\n            redoRecord.push(record);\r\n            emitter.emit('undo/redo');\r\n        });\r\n\r\n        hotkeys('ctrl+y, shift+command+z', () => {\r\n            if (!redoRecord.length) return;\r\n            let record: Action = redoRecord.pop();\r\n            record.redo(record.param);\r\n            undoRecord.push(record);\r\n            emitter.emit('undo/redo');\r\n        });\r\n\r\n        myMap.onClick = (x: number, y: number, click: Click) => {\r\n            if (click === Click.RIGHT) {\r\n                for (let i = MapObjects['house_h'].length - 1; i >= 0; --i) {\r\n                    let combination = MapObjects['house_h'][i];\r\n                    myMap.stack(x + combination.offset.x, y + combination.offset.y, {\r\n                        r: combination.r,\r\n                        i: combination.i,\r\n                        layer: combination.layer\r\n                    });\r\n                }\r\n            } else {\r\n                myMap.stack(x, y, { r: '0', i: selected, layer: 0 }) && undoRecord.push(deepFreeze({\r\n                    undo: (obj) => myMap.delete(obj.x, obj.y),\r\n                    redo: (obj) => myMap.stack(obj.x, obj.y, obj.tile),\r\n                    param: { x: x, y: y, tile: { r: '0', i: selected, layer: 2 } }\r\n                }) as Action) && emitter.emit('undo/redo');\r\n            }\r\n        }\r\n\r\n        myMap.onDrag = (x1, y1, x2, y2): void => {\r\n            //console.log(JSON.stringify(myMap.exportMapObject(x1, y1, x2, y2)));\r\n        }\r\n        mapViewer.stage.addChild(myMap);\r\n        ReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n        serviceWorker.register();\r\n    });\r\n});\r\n\r\n","\r\n/**\r\n * Freeze the object deeply so it cannot be changed.\r\n * @param obj The object that needs to be freezed\r\n */\r\nexport const deepFreeze = (obj: object) => {\r\n    let names: string[] = Object.getOwnPropertyNames(obj);\r\n\r\n    for (let i = names.length - 1; i >= 0; --i) {\r\n        let prop: object = obj[names[i]];\r\n        if (prop != null && typeof prop == 'object') deepFreeze(prop);\r\n    }\r\n\r\n    return Object.freeze(obj);\r\n}","module.exports = __webpack_public_path__ + \"static/media/tileset_0.6be70081.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_1.b1a316a6.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_2.cd53c9c1.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_3.a0309325.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_4.c7a63559.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_5.bdff645c.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_6.7b223283.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_7.20a81f28.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_8.63e0fb4f.png\";","module.exports = __webpack_public_path__ + \"static/media/tileset_9.90094cf3.png\";"],"sourceRoot":""}